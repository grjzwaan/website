<p>A short note on <a href="https://aws.amazon.com/dynamodb/">DynamoDB</a> of AWS and how it suprisingly gives <code class="language-plaintext highlighter-rouge">Decimals</code> when you extract records. And forced me to write ducktape-code.</p>

<h2 id="the-story">The story</h2>
<p>DynamoDB implicitely converts integers to decimals. Decimals cause some problems in Python code since it is not a basic type. For example, <code class="language-plaintext highlighter-rouge">json.dumps()</code> doesn’t work anymore.</p>

<ol>
  <li>You put a Python datastructure with lists and dictionairies into DynamoDB with strings and integers.</li>
  <li>DynamoDB converts and stores the datastructure</li>
  <li>You load an entry from DynamoDB</li>
  <li>…it suddenly contains <code class="language-plaintext highlighter-rouge">Decimals</code> instead of integers</li>
  <li>…and <code class="language-plaintext highlighter-rouge">json.dumps()</code> crashes (among others)</li>
</ol>

<h2 id="the-solution">The ‘solution’</h2>
<p>I now simply convert decimals back to <code class="language-plaintext highlighter-rouge">float</code> and <code class="language-plaintext highlighter-rouge">int</code>. The alternative of storing the object as a string (convert to JSON) I dislike. Figuring out how to configure DynamoDB…I couldn’t find a decent way within half an hour. I did find a <a href="https://github.com/boto/boto3/issues/369">discussion</a> on a feature request to disable decimals and/or find some sane way to work with it, but no solutions.</p>

<p>So I wrote a little function to convert a dictionary:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">convert_decimal</span><span class="p">(</span><span class="n">dictionary</span><span class="p">):</span>
    <span class="s">""" Converts decimals to float and int. """</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">dictionairy</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dictionary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dictionary</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dictionary</span>
</code></pre></div></div>
