<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Import fun with Parcel | vanderzwaan.dev</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Import fun with Parcel" />
<meta name="author" content="Ruben van der Zwaan" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Bundling for NodeJS has ways to go before being comparable to compiled languages." />
<meta property="og:description" content="Bundling for NodeJS has ways to go before being comparable to compiled languages." />
<link rel="canonical" href="https://grjzwaan.github.io/website/2019/10/28/import-fun-with-parcel.html" />
<meta property="og:url" content="https://grjzwaan.github.io/website/2019/10/28/import-fun-with-parcel.html" />
<meta property="og:site_name" content="vanderzwaan.dev" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-10-28T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://grjzwaan.github.io/website/2019/10/28/import-fun-with-parcel.html","@type":"BlogPosting","headline":"Import fun with Parcel","dateModified":"2019-10-28T00:00:00-05:00","datePublished":"2019-10-28T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://grjzwaan.github.io/website/2019/10/28/import-fun-with-parcel.html"},"author":{"@type":"Person","name":"Ruben van der Zwaan"},"description":"Bundling for NodeJS has ways to go before being comparable to compiled languages.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/website/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://grjzwaan.github.io/website/feed.xml" title="vanderzwaan.dev" />

<link href="https://fonts.googleapis.com/css?family=Libre+Baskerville|Open+Sans" rel="stylesheet"><link rel="shortcut icon" type="image/x-icon" href="/website/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/website/">vanderzwaan.dev</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/website/about/">About Me</a><a class="page-link" href="/website/search/">Search</a><a class="page-link" href="/website/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Import fun with Parcel</h1><p class="page-description">Bundling for NodeJS has ways to go before being comparable to compiled languages.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2019-10-28T00:00:00-05:00" itemprop="datePublished">
        Oct 28, 2019
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Ruben van der Zwaan</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Today I was having fun with Parcel and generating a bundle for NodeJS. Very convenient, only importing seemed weird. Some imports were ‘successful’ in the sense that both Parcel and NodeJS could resolve it, but the import was <code class="language-plaintext highlighter-rouge">{default: {}}</code>. Hmmm.</p>

<!-- more -->

<p>I also write my thoughts on bundlers I used. Depending on your standards it might or might not be a review.</p>

<h1 id="bundling">Bundling</h1>

<blockquote>
  <p>A JavaScript bundler is a tool that puts your code and all its dependencies together in one JavaScript file.</p>
</blockquote>

<p>There are many reasons you want this. One of the main reasons is if you develop a client side Javascript library. You actually need to serve all your Javascript and cannot rely on the client to have dependencies installed.</p>

<p>Further, most of these bundlers transpile sane Javascript to insane Javascript that is backwards compatible, and minify it. Notice that sane is relative here.</p>

<p>If you’re stumped by these bundlers and why it seems a big deal, you’re probably programming in Go or Java where the compiler actually makes bundles for you.</p>

<p>For NodeJS backend applications you could rely on the package information and get the dependencies when deploying or include them in your Docker image. But I do not like that.</p>

<p>Even if you’re meticulous in pinning exact versions of your dependencies other could forget to update version numbers. Or, pull their packages from NPM and all your deployments/builds fail.</p>

<p>You argue that I should not be so cynical. Ok, I hope you at least stop pulling dependencies during deployment, but I’ll go with it.</p>

<p>It’s also wasteful. You’re pulling huge amounts of dependencies and most likely you’re only using a small fraction. For me it’s no exception to have 50-100mb of modules but the compiled Javascript file is ~20kb. You can make deployment much faster and it’s self-contained.</p>

<h1 id="bundlers">Bundlers</h1>

<p>I’ve used webpack, Rollup and Parcel. Webpack feels like making art with spaghetti and glue. It’s about the process, not the result and only fun if you’re not cleaning it up. I’m not biased against spaghetti and glue, but rather not have them in my code.</p>

<p>Rollup was pretty nice to use and I started using it because of Sapper and Svelte. Support for NodeJS bundles is lacking and Node Addons are not supported. I tried to make my own plugin for this but…one hour of weird errors and I bailed. Also because I seemed to include many plugins to make it work for NodeJS.</p>

<p>Parcel was working within 5 minutes and got me a nice NodeJS bundle, including the binaries in a Node Addon. Add a nice code generator and we’re good to go! Or not. One weird error got my stumped.</p>

<p>Consider two imports of files with special characters:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">route_1</span> <span class="k">from</span> <span class="p">(</span><span class="dl">'</span><span class="s1">./routes/a/b/c/[slug].js</span><span class="dl">'</span><span class="p">)</span>
<span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">route_2</span> <span class="k">from</span> <span class="p">(</span><span class="dl">'</span><span class="s1">./routes/a/b/c/&lt;slug&gt;.js</span><span class="dl">'</span><span class="p">)</span>
</code></pre></div></div>
<p>The imports resolve and, yes, both files really, really, really exist.</p>

<p>Normally this works fine, but Parcel does something with it. The imports resulted in:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">route_1</span> <span class="o">=</span> <span class="p">{</span><span class="na">default</span><span class="p">:</span> <span class="p">{}}</span>
<span class="nx">route_2</span> <span class="o">=</span> <span class="p">{</span><span class="na">get</span><span class="p">:</span> <span class="p">[</span><span class="na">AsyncFunction</span><span class="p">:</span> <span class="kd">get</span><span class="p">],</span> <span class="na">post</span><span class="p">:</span> <span class="p">[</span><span class="na">AsyncFunction</span><span class="p">:</span> <span class="nx">post</span><span class="p">]</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></div></div>

<p>Huh.</p>

<p>I did find out what the underlying issue is (probably some regex stuff in imports), but even when escaping the square brackets it did not work. The point brackets worked, so I consider it solved.</p>

  </div><a class="u-url" href="/website/2019/10/28/import-fun-with-parcel.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/website/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/website/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/website/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Blog by Ruben van der Zwaan</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/grjzwaan" title="grjzwaan"><svg class="svg-icon grey"><use xlink:href="/website/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
