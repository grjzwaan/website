<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Experiment: Blog with Sapper | vanderzwaan.dev</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Experiment: Blog with Sapper" />
<meta name="author" content="Ruben van der Zwaan" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The post where I went experimental and used Sapper/Svelte for my website." />
<meta property="og:description" content="The post where I went experimental and used Sapper/Svelte for my website." />
<link rel="canonical" href="https://grjzwaan.github.io/website/2019/10/14/experiment-blog-with-sapper.html" />
<meta property="og:url" content="https://grjzwaan.github.io/website/2019/10/14/experiment-blog-with-sapper.html" />
<meta property="og:site_name" content="vanderzwaan.dev" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-10-14T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://grjzwaan.github.io/website/2019/10/14/experiment-blog-with-sapper.html","@type":"BlogPosting","headline":"Experiment: Blog with Sapper","dateModified":"2019-10-14T00:00:00-05:00","datePublished":"2019-10-14T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://grjzwaan.github.io/website/2019/10/14/experiment-blog-with-sapper.html"},"author":{"@type":"Person","name":"Ruben van der Zwaan"},"description":"The post where I went experimental and used Sapper/Svelte for my website.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/website/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://grjzwaan.github.io/website/feed.xml" title="vanderzwaan.dev" /><!-- the google_analytics_id gets auto inserted from the config file -->



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-126301727-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-126301727-2');
</script>




<link href="https://fonts.googleapis.com/css?family=Libre+Baskerville|Open+Sans" rel="stylesheet"><link rel="shortcut icon" type="image/x-icon" href="/website/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/website/">vanderzwaan.dev</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/website/about/">About Me</a><a class="page-link" href="/website/search/">Search</a><a class="page-link" href="/website/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Experiment: Blog with Sapper</h1><p class="page-description">The post where I went experimental and used Sapper/Svelte for my website.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2019-10-14T00:00:00-05:00" itemprop="datePublished">
        Oct 14, 2019
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Ruben van der Zwaan</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>This blog now runs on Sapper. The experiment succeeded but I do miss some quality of life functionality of Hugo.</p>

<!-- more -->

<h1 id="why-change">Why change?</h1>

<p>This blog used to be a very simple static website that was generated by Hugo from some Markdown files. It’s very convenient to work and I automatically deployed new versions whenever I pushed changes to the repository.</p>

<p>Now, if life was easy why would I change? Because playing with Sapper is fun, specifically building a front end with the underlying framework Svelte is lots of fun.</p>

<h1 id="svelte-and-sapper">Svelte and Sapper</h1>

<p>Svelte is in the same category as React and Vue. It’s a framework to build a front end and stay sane. Building an interactive website with vanilla Javascript usually makes me want to cry.</p>

<p>I’ve worked with React and Vue before and although it was quite smooth and the documentation is perfect, I always felt I type lots of code but it doesn’t do much. Both frameworks were getting in the way and it felt like magic sprinkled with other peoples components. Ugh. Getting an autocomplete to work where I needed not solution x but x’ was a horrible few hours.</p>

<p>Svelte felt different. I could write code as I wanted to and Svelte would compile vanilla Javascript to Javascript that interacted with the DOM. It feels great! As a test I wrote a pixel editor that could import files and drag and drop…from scratch. It felt wonderful and very productive.</p>

<p>So far my love story with Svelte.</p>

<p>Sapper is like Next.js but then with Svelte. Normally I build lots of stuff in Python but this tempted me to build applications with Sapper.</p>

<p>I still have to get used to NodeJS libraries and NPM compared to Python. Packages for Python feel complete and robust. In Javascript land…ugh…people really stack lots and lots of libraries on top of each other. It cannot be good if there is a package left-pad that puts the Javascript world in chaos as it’s pulled from NPM.</p>

<p>But Sapper tempts me.</p>

<h1 id="sapper-export">Sapper export</h1>

<p>Sapper has a command to export the application as a static website. It does so by sniffing out the calls to the server side and links and storing the results.</p>

<p>Seems pretty good, but there is no official support for Markdown, so you need to do some work yourself. I used the official website, and two repositories as a starting point to glean how they made it work: David’s blog and from a repository of Maxi Ferreira.</p>

<p>The main idea is to find .md files and put those in a data structure so that a webservice can serve the JSON (with raw HTML for the .md documents) to the client side application.</p>

<p>In the examples the .md files were in a single directory and they didn’t use images. Currently images should be in the static folder. The workflow is then to first upload images, and then refer to them from your .md file. Awkward.</p>

<h1 id="goal">Goal</h1>

<p>The goal is to support the following directory structure:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/posts/2019/01/09/dogs.md
/posts/2019/11/10/fishes/index.md
/posts/2019/11/10/fishes/happy-fish.png
/posts/2019/11/10/fishes/sad-fish.png
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">/posts/2019/11/10/fishes/index.md</code> document refers to <code class="language-plaintext highlighter-rouge">happy-fish.png</code> and <code class="language-plaintext highlighter-rouge">sad-fish.png</code> with a relative path. Your favorite editor can then give nice previews.</p>

<p>I couldn’t make it work with Sapper to have an arbitrary amount of <code class="language-plaintext highlighter-rouge">/</code>’s in the URL, so I made due with <code class="language-plaintext highlighter-rouge">-</code> instead.</p>

<p>The slugs in the URL should be:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vanderzwaan.dev/blog/2019-01-09-dogs
vanderzwaan.dev/blog/2019-11-10-fishes
</code></pre></div></div>

<p>The images should be reachable with urls:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>2019-11-10-fishes/happy-fish.png
2019-11-10-fishes/sad-fish.png
</code></pre></div></div>

<h1 id="find-all-markdown-files">Find all Markdown files</h1>

<p>Finding the <code class="language-plaintext highlighter-rouge">.md</code> files should be easy, something like this will do:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">locations</span> <span class="o">=</span> <span class="nx">glob</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">POSTS_DIR</span><span class="p">}</span><span class="s2">/**/*.md`</span><span class="p">);</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">posts</span> <span class="o">=</span> <span class="nx">locations</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span> <span class="nx">loc</span> <span class="o">=&gt;</span> <span class="nx">getPost</span><span class="p">(</span><span class="nx">loc</span><span class="p">)).</span><span class="nx">map</span><span class="p">(</span><span class="nx">post</span> <span class="o">=&gt;</span> <span class="nx">parsePost</span><span class="p">(</span><span class="nx">post</span><span class="p">));</span>
</code></pre></div></div>

<p>There was a bit of logic to map file names to slugs: <code class="language-plaintext highlighter-rouge">a/b/c/index.md</code> to <code class="language-plaintext highlighter-rouge">a-b-c</code> and <code class="language-plaintext highlighter-rouge">a/doc.md</code> to <code class="language-plaintext highlighter-rouge">a-doc</code>. Nothing terribly complicated.</p>

<h1 id="create-an-endpoint-blogslugimg">Create an endpoint <code class="language-plaintext highlighter-rouge">/blog/[slug]/[img]</code></h1>

<p>We need to be able to serve the images in the blogpost so let’s create an endpoint that returns a certain image for a post. But then we also need to have a list of images and their locations.</p>

<p>For each post we also find the images in the same folder and store them:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">const</span> <span class="nx">attachments</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
    <span class="nx">glob</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">base</span><span class="p">}</span><span class="s2">/*.png`</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">f</span> <span class="o">=&gt;</span> <span class="nx">getFileInformation</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">POSTS_DIR</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">attachment</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">attachments</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">attachment</span><span class="p">.</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">attachment</span><span class="p">);</span>
    <span class="p">});</span>
</code></pre></div></div>
<p>The service is a standard Express server route that serves an image.</p>

<h1 id="add-images-to-sapper-export">Add images to sapper export</h1>

<p>It seems as if we should be done, but I found out that sapper export only follows <a> links and not the <img href="my image" /> references.</a></p>

<p>This required some code changes to Sapper export to also follow href attributes and a new mode to read files as images are in binary.</p>

<p>I should probably make a pull request for this, but currently the code is hacky.</p>

<p>#Result</p>

<p>I’m pretty happy with the result, but I do miss the following nice things from Hugo:</p>

<ul>
  <li>Scaffolding</li>
  <li>It watches the <code class="language-plaintext highlighter-rouge">.md</code> files, Sapper does not (so manual recompile)</li>
</ul>


  </div><a class="u-url" href="/website/2019/10/14/experiment-blog-with-sapper.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/website/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/website/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/website/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Blog by Ruben van der Zwaan</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/grjzwaan" title="grjzwaan"><svg class="svg-icon grey"><use xlink:href="/website/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
